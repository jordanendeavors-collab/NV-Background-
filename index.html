<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A3 Smarthome — Background Check Authorization</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --red: #CC2222;
    --red-dark: #9E1A1A;
    --red-light: #FFF0F0;
    --black: #111111;
    --gray-800: #2A2A2A;
    --gray-600: #555555;
    --gray-400: #999999;
    --gray-200: #E8E8E8;
    --gray-100: #F5F5F5;
    --white: #FFFFFF;
    --success: #1A7A3F;
    --success-bg: #EDFAF3;
    --font: 'DM Sans', sans-serif;
    --mono: 'DM Mono', monospace;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--font);
    background: #F0EDED;
    color: var(--black);
    min-height: 100vh;
  }

  /* ─── PROGRESS BAR ─────────────────────────────────────────────────── */
  .progress-wrap {
    position: sticky; top: 0; z-index: 100;
    background: var(--black);
    padding: 12px 24px;
    display: flex; align-items: center; gap: 16px;
  }
  .progress-logo {
    display: flex; align-items: center; gap: 10px;
    flex-shrink: 0;
  }
  .logo-box {
    background: var(--red); width: 32px; height: 32px;
    display: flex; align-items: center; justify-content: center;
    font-size: 13px; font-weight: 700; color: white; border-radius: 4px;
  }
  .logo-text { color: white; font-size: 13px; font-weight: 600; }
  .progress-bar-track {
    flex: 1; height: 4px; background: #333;
    border-radius: 2px; overflow: hidden;
  }
  .progress-bar-fill {
    height: 100%; background: var(--red);
    border-radius: 2px;
    transition: width 0.4s ease;
    width: 0%;
  }
  .progress-label {
    color: #888; font-size: 12px; font-family: var(--mono);
    flex-shrink: 0; min-width: 80px; text-align: right;
  }

  /* ─── LAYOUT ────────────────────────────────────────────────────────── */
  .page-wrap {
    max-width: 780px;
    margin: 40px auto;
    padding: 0 20px 80px;
  }

  /* ─── HEADER ────────────────────────────────────────────────────────── */
  .form-header {
    background: var(--white);
    border-top: 5px solid var(--red);
    padding: 32px 40px 28px;
    margin-bottom: 2px;
  }
  .header-top {
    display: flex; align-items: flex-start; justify-content: space-between;
    margin-bottom: 20px;
  }
  .header-brand h1 {
    font-size: 26px; font-weight: 700; color: var(--red);
    letter-spacing: -0.5px;
  }
  .header-brand .subtitle {
    font-size: 13px; color: var(--gray-600); margin-top: 4px;
    font-weight: 400;
  }
  .header-badge {
    background: var(--red-light); border: 1px solid #F5C0C0;
    color: var(--red-dark); font-size: 11px; font-weight: 600;
    padding: 4px 10px; border-radius: 20px;
    font-family: var(--mono); letter-spacing: 0.5px;
    white-space: nowrap;
  }
  .header-meta {
    display: flex; gap: 20px; flex-wrap: wrap;
    padding-top: 16px;
    border-top: 1px solid var(--gray-200);
  }
  .meta-item { font-size: 11px; color: var(--gray-600); font-family: var(--mono); }
  .meta-item strong { color: var(--black); }

  /* ─── SECTIONS ──────────────────────────────────────────────────────── */
  .form-section {
    background: var(--white);
    padding: 28px 40px;
    margin-bottom: 2px;
  }
  .section-title {
    font-size: 11px; font-weight: 600; color: var(--red);
    letter-spacing: 1.5px; text-transform: uppercase;
    font-family: var(--mono);
    margin-bottom: 4px;
  }
  .section-heading {
    font-size: 18px; font-weight: 700; color: var(--black);
    margin-bottom: 16px; letter-spacing: -0.3px;
  }
  .section-divider {
    height: 1px; background: var(--gray-200);
    margin: 20px 0;
  }

  /* ─── FIELDS ────────────────────────────────────────────────────────── */
  .field-row {
    display: grid; gap: 16px;
    margin-bottom: 16px;
  }
  .field-row.cols-2 { grid-template-columns: 1fr 1fr; }
  .field-row.cols-3 { grid-template-columns: 2fr 1fr 1fr; }
  .field-row.cols-1 { grid-template-columns: 1fr; }

  .field-group { display: flex; flex-direction: column; gap: 5px; }
  .field-group label {
    font-size: 11px; font-weight: 600; color: var(--gray-600);
    letter-spacing: 0.8px; text-transform: uppercase;
    font-family: var(--mono);
  }
  .field-group label .req { color: var(--red); margin-left: 2px; }

  input[type="text"], input[type="email"], input[type="tel"],
  input[type="date"], select, textarea {
    font-family: var(--font);
    font-size: 15px;
    padding: 10px 14px;
    border: 1.5px solid var(--gray-200);
    background: var(--gray-100);
    border-radius: 6px;
    color: var(--black);
    transition: border-color 0.15s, background 0.15s;
    width: 100%;
    outline: none;
  }
  input:focus, select:focus, textarea:focus {
    border-color: var(--red);
    background: var(--white);
    box-shadow: 0 0 0 3px rgba(204,34,34,0.08);
  }
  input.error, select.error {
    border-color: var(--red);
    background: var(--red-light);
  }
  .field-error {
    font-size: 11px; color: var(--red);
    font-family: var(--mono); margin-top: 2px;
    display: none;
  }
  .field-error.show { display: block; }

  /* ─── LEGAL TEXT ────────────────────────────────────────────────────── */
  .legal-box {
    background: var(--gray-100);
    border-left: 3px solid var(--red);
    padding: 16px 20px;
    font-size: 13px;
    line-height: 1.7;
    color: var(--gray-800);
    margin-bottom: 16px;
    border-radius: 0 6px 6px 0;
  }
  .legal-box.important {
    background: var(--red-light);
    border-left-color: var(--red-dark);
  }
  .legal-list {
    list-style: none; padding: 0; margin: 8px 0;
  }
  .legal-list li {
    padding: 5px 0 5px 18px;
    position: relative;
    font-size: 13px; line-height: 1.6; color: var(--gray-800);
  }
  .legal-list li::before {
    content: "›"; position: absolute; left: 0;
    color: var(--red); font-weight: 700;
  }

  /* ─── CHECKBOXES ────────────────────────────────────────────────────── */
  .checkbox-group { display: flex; flex-direction: column; gap: 10px; margin: 12px 0; }
  .checkbox-item {
    display: flex; align-items: flex-start; gap: 12px;
    padding: 12px 14px;
    border: 1.5px solid var(--gray-200);
    border-radius: 6px;
    cursor: pointer;
    transition: border-color 0.15s, background 0.15s;
  }
  .checkbox-item:hover { border-color: var(--red); background: var(--red-light); }
  .checkbox-item input[type="checkbox"] {
    width: 18px; height: 18px; flex-shrink: 0;
    accent-color: var(--red); cursor: pointer;
    margin-top: 2px;
  }
  .checkbox-item .check-label {
    font-size: 13px; line-height: 1.5; color: var(--gray-800);
  }

  /* ─── RIGHTS ITEMS ──────────────────────────────────────────────────── */
  .rights-item {
    display: flex; gap: 14px; align-items: flex-start;
    padding: 10px 0;
    border-bottom: 1px solid var(--gray-200);
  }
  .rights-item:last-child { border-bottom: none; }
  .rights-num {
    background: var(--red); color: white;
    width: 22px; height: 22px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 11px; font-weight: 700; flex-shrink: 0;
    margin-top: 1px;
  }
  .rights-text { font-size: 13px; line-height: 1.6; color: var(--gray-800); }

  /* ─── SIGNATURE PAD ─────────────────────────────────────────────────── */
  .sig-wrap {
    border: 2px dashed var(--gray-400);
    border-radius: 8px;
    overflow: hidden;
    position: relative;
    background: var(--gray-100);
    transition: border-color 0.2s;
  }
  .sig-wrap:hover { border-color: var(--red); }
  .sig-wrap.has-sig { border-color: var(--red); border-style: solid; }
  #sigCanvas {
    display: block; width: 100%; height: 160px;
    cursor: crosshair; touch-action: none;
  }
  .sig-actions {
    display: flex; justify-content: space-between; align-items: center;
    padding: 8px 14px;
    border-top: 1px solid var(--gray-200);
    background: var(--white);
  }
  .sig-hint { font-size: 11px; color: var(--gray-400); font-family: var(--mono); }
  .btn-clear-sig {
    font-size: 11px; color: var(--red); background: none;
    border: 1px solid var(--red); padding: 3px 10px;
    border-radius: 4px; cursor: pointer; font-family: var(--mono);
    transition: all 0.15s;
  }
  .btn-clear-sig:hover { background: var(--red); color: white; }

  /* ─── AUDIT TRAIL PANEL ─────────────────────────────────────────────── */
  .audit-panel {
    background: var(--black);
    border-radius: 8px;
    padding: 20px 24px;
    margin-top: 24px;
  }
  .audit-title {
    font-size: 11px; font-weight: 600; color: var(--gray-400);
    letter-spacing: 1.5px; text-transform: uppercase;
    font-family: var(--mono); margin-bottom: 14px;
    display: flex; align-items: center; gap: 8px;
  }
  .audit-dot { width: 7px; height: 7px; border-radius: 50%; background: #2ECC71; }
  .audit-row {
    display: flex; gap: 14px; align-items: flex-start;
    padding: 8px 0;
    border-bottom: 1px solid #222;
    font-family: var(--mono);
  }
  .audit-row:last-child { border-bottom: none; }
  .audit-key { font-size: 10px; color: #666; min-width: 130px; flex-shrink: 0; }
  .audit-val { font-size: 11px; color: #CCC; word-break: break-all; }
  .audit-val.pending { color: #555; font-style: italic; }

  /* ─── SUBMIT BUTTON ─────────────────────────────────────────────────── */
  .submit-wrap {
    margin-top: 28px;
    display: flex; flex-direction: column; gap: 12px; align-items: center;
  }
  .btn-submit {
    width: 100%;
    background: var(--red);
    color: white;
    border: none;
    padding: 16px 32px;
    font-size: 15px;
    font-weight: 700;
    font-family: var(--font);
    letter-spacing: 0.3px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.15s, transform 0.1s;
    position: relative;
    overflow: hidden;
  }
  .btn-submit:hover { background: var(--red-dark); transform: translateY(-1px); }
  .btn-submit:active { transform: translateY(0); }
  .btn-submit:disabled { background: var(--gray-400); cursor: not-allowed; transform: none; }
  .submit-disclaimer {
    font-size: 11px; color: var(--gray-400); text-align: center;
    font-family: var(--mono); line-height: 1.6;
  }

  /* ─── SUCCESS STATE ─────────────────────────────────────────────────── */
  #successScreen {
    display: none;
    background: var(--white);
    padding: 60px 40px;
    text-align: center;
  }
  .success-icon {
    width: 72px; height: 72px; background: var(--success-bg);
    border-radius: 50%; display: flex; align-items: center;
    justify-content: center; margin: 0 auto 24px;
    font-size: 32px;
  }
  .success-title {
    font-size: 24px; font-weight: 700; color: var(--black);
    margin-bottom: 8px;
  }
  .success-sub {
    font-size: 14px; color: var(--gray-600); margin-bottom: 32px;
    line-height: 1.6;
  }
  .receipt-box {
    background: var(--black); border-radius: 8px;
    padding: 20px 24px; text-align: left; margin-bottom: 24px;
  }
  .receipt-title {
    font-size: 10px; color: #666; font-family: var(--mono);
    letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 14px;
  }
  .receipt-row {
    display: flex; justify-content: space-between; gap: 16px;
    padding: 6px 0; border-bottom: 1px solid #1E1E1E;
    font-family: var(--mono);
  }
  .receipt-row:last-child { border-bottom: none; }
  .receipt-key { font-size: 10px; color: #666; }
  .receipt-val { font-size: 11px; color: #CCC; text-align: right; }
  .btn-download-report {
    background: var(--success); color: white;
    border: none; padding: 12px 28px;
    font-size: 14px; font-weight: 600; font-family: var(--font);
    border-radius: 6px; cursor: pointer;
    transition: opacity 0.15s;
    margin-right: 10px;
  }
  .btn-download-report:hover { opacity: 0.9; }
  .btn-new-form {
    background: none; color: var(--gray-600);
    border: 1.5px solid var(--gray-200); padding: 12px 28px;
    font-size: 14px; font-weight: 600; font-family: var(--font);
    border-radius: 6px; cursor: pointer;
    transition: all 0.15s;
  }
  .btn-new-form:hover { border-color: var(--red); color: var(--red); }

  @media (max-width: 600px) {
    .page-wrap { padding: 0 0 60px; margin: 0; }
    .form-header, .form-section { padding: 24px 20px; }
    .field-row.cols-2, .field-row.cols-3 { grid-template-columns: 1fr; }
    .header-top { flex-direction: column; gap: 12px; }
    #successScreen { padding: 40px 20px; }
  }
</style>
</head>
<body>

<!-- ── LOGIN GATE SCREEN ─────────────────────────────────────────────────── -->
<div id="loginScreen" style="
  min-height:100vh; display:flex; align-items:center; justify-content:center;
  background:#111111; font-family:'DM Sans',sans-serif;
">
  <div style="
    background:#1A1A1A; border:1px solid #2A2A2A; border-top:4px solid #CC2222;
    border-radius:12px; padding:48px 40px; width:100%; max-width:400px; text-align:center;
  ">
    <div style="
      background:#CC2222; width:52px; height:52px; border-radius:8px;
      display:flex; align-items:center; justify-content:center;
      margin:0 auto 20px; font-size:20px; font-weight:800; color:white;
    ">A³</div>
    <div style="font-size:20px; font-weight:700; color:white; margin-bottom:4px;">A3 Smarthome</div>
    <div style="font-size:12px; color:#666; margin-bottom:32px; font-family:'DM Mono',monospace; letter-spacing:1px;">
      AUTHORIZED ACCESS ONLY
    </div>
    <form id="loginForm">
      <div style="text-align:left; margin-bottom:14px;">
        <label style="font-size:11px; font-weight:600; color:#888; letter-spacing:1px; text-transform:uppercase; font-family:'DM Mono',monospace;">Username</label>
        <input type="text" id="loginUser" autocomplete="username"
          placeholder="Enter username"
          style="
            width:100%; margin-top:6px; padding:12px 14px;
            background:#111; border:1.5px solid #2A2A2A; border-radius:6px;
            color:white; font-size:15px; font-family:'DM Sans',sans-serif; outline:none;
          "
          onfocus="this.style.borderColor='#CC2222'" onblur="this.style.borderColor='#2A2A2A'"
        >
      </div>
      <div style="text-align:left; margin-bottom:20px;">
        <label style="font-size:11px; font-weight:600; color:#888; letter-spacing:1px; text-transform:uppercase; font-family:'DM Mono',monospace;">Password</label>
        <input type="password" id="loginPass" autocomplete="current-password"
          placeholder="Enter password"
          style="
            width:100%; margin-top:6px; padding:12px 14px;
            background:#111; border:1.5px solid #2A2A2A; border-radius:6px;
            color:white; font-size:15px; font-family:'DM Sans',sans-serif; outline:none;
          "
          onfocus="this.style.borderColor='#CC2222'" onblur="this.style.borderColor='#2A2A2A'"
        >
      </div>
      <div id="loginErr" style="
        display:none; background:#2A0A0A; border:1px solid #5A1A1A;
        color:#FF6B6B; font-size:12px; padding:10px 14px;
        border-radius:6px; margin-bottom:16px; font-family:'DM Mono',monospace;
      ">⚠ Invalid username or password</div>
      <button type="submit" style="
        width:100%; background:#CC2222; color:white; border:none;
        padding:14px; font-size:15px; font-weight:700;
        font-family:'DM Sans',sans-serif; border-radius:8px; cursor:pointer;
        transition:background 0.15s;
      "
        onmouseover="this.style.background='#9E1A1A'"
        onmouseout="this.style.background='#CC2222'"
      >Access Form</button>
    </form>
    <div style="margin-top:24px; font-size:11px; color:#444; font-family:'DM Mono',monospace; line-height:1.6;">
      A3 Smarthome · Clifton Wayne Jordan, License Holder<br>
      Unauthorized access is prohibited
    </div>
  </div>
</div>

<!-- ── MAIN APP (hidden until login) ────────────────────────────────────────── -->
<div id="mainApp" style="display:none;">


<!-- Progress Bar -->
<div class="progress-wrap">
  <div class="progress-logo">
    <div class="logo-box">A³</div>
    <span class="logo-text">Smarthome</span>
  </div>
  <div class="progress-bar-track">
    <div class="progress-bar-fill" id="progressFill"></div>
  </div>
  <div class="progress-label" id="progressLabel">0 / 7</div>
</div>

<div class="page-wrap">

  <!-- ── HEADER ──────────────────────────────────────────────────────── -->
  <div class="form-header">
    <div class="header-top">
      <div class="header-brand">
        <h1>Background Check Authorization</h1>
        <div class="subtitle">A3 Smarthome &nbsp;·&nbsp; Clifton Wayne Jordan, License Holder &nbsp;·&nbsp; State of Nevada</div>
      </div>
      <div class="header-badge">NV • FCRA COMPLIANT</div>
    </div>
    <div class="header-meta">
      <div class="meta-item"><strong>Form ID</strong> &nbsp;<span id="formId">Generating…</span></div>
      <div class="meta-item"><strong>Opened</strong> &nbsp;<span id="openTime">—</span></div>
      <div class="meta-item"><strong>IP Captured</strong> &nbsp;<span id="ipDisplay">Detecting…</span></div>
      <div class="meta-item"><strong>User Agent</strong> &nbsp;<span id="uaDisplay">—</span></div>
    </div>
  </div>

  <form id="bgForm" novalidate>

    <!-- ── SECTION 1: APPLICANT INFO ─────────────────────────────────── -->
    <div class="form-section" data-section="1">
      <div class="section-title">Section 01</div>
      <div class="section-heading">Applicant Information</div>
      <div class="field-row cols-1">
        <div class="field-group">
          <label>Full Legal Name <span class="req">*</span></label>
          <input type="text" id="fullName" name="fullName" placeholder="As it appears on government-issued ID" required>
          <div class="field-error" id="fullName-err">Required field</div>
        </div>
      </div>
      <div class="field-row cols-2">
        <div class="field-group">
          <label>Date of Birth <span class="req">*</span></label>
          <input type="date" id="dob" name="dob" required>
          <div class="field-error" id="dob-err">Required field</div>
        </div>
        <div class="field-group">
          <label>Last 4 of SSN <span class="req">*</span></label>
          <input type="text" id="ssn4" name="ssn4" maxlength="4" placeholder="XXXX" pattern="[0-9]{4}" required>
          <div class="field-error" id="ssn4-err">4 digits required</div>
        </div>
      </div>
      <div class="field-row cols-1">
        <div class="field-group">
          <label>Current Street Address <span class="req">*</span></label>
          <input type="text" id="address" name="address" placeholder="123 Main St" required>
          <div class="field-error" id="address-err">Required field</div>
        </div>
      </div>
      <div class="field-row cols-3">
        <div class="field-group">
          <label>City <span class="req">*</span></label>
          <input type="text" id="city" name="city" required>
          <div class="field-error" id="city-err">Required</div>
        </div>
        <div class="field-group">
          <label>State <span class="req">*</span></label>
          <input type="text" id="state" name="state" maxlength="2" placeholder="NV" required>
          <div class="field-error" id="state-err">Required</div>
        </div>
        <div class="field-group">
          <label>ZIP <span class="req">*</span></label>
          <input type="text" id="zip" name="zip" maxlength="10" placeholder="89101" required>
          <div class="field-error" id="zip-err">Required</div>
        </div>
      </div>
      <div class="field-row cols-2">
        <div class="field-group">
          <label>Phone Number <span class="req">*</span></label>
          <input type="tel" id="phone" name="phone" placeholder="(702) 555-0100" required>
          <div class="field-error" id="phone-err">Required field</div>
        </div>
        <div class="field-group">
          <label>Email Address <span class="req">*</span></label>
          <input type="email" id="email" name="email" placeholder="you@email.com" required>
          <div class="field-error" id="email-err">Valid email required</div>
        </div>
      </div>
      <div class="field-row cols-2">
        <div class="field-group">
          <label>Driver's License Number</label>
          <input type="text" id="dlNum" name="dlNum" placeholder="NV license number">
        </div>
        <div class="field-group">
          <label>Issuing State</label>
          <input type="text" id="dlState" name="dlState" maxlength="2" placeholder="NV">
        </div>
      </div>
      <div class="field-row cols-1">
        <div class="field-group">
          <label>Position / Role Applying For <span class="req">*</span></label>
          <input type="text" id="position" name="position" placeholder="CCC Representative" required>
          <div class="field-error" id="position-err">Required field</div>
        </div>
      </div>
    </div>

    <!-- ── SECTION 2: DISCLOSURE ──────────────────────────────────────── -->
    <div class="form-section" data-section="2">
      <div class="section-title">Section 02</div>
      <div class="section-heading">Nevada & Federal Disclosure</div>
      <div class="legal-box">
        This disclosure is made pursuant to the federal Fair Credit Reporting Act (FCRA), 15 U.S.C. § 1681 et seq., and Nevada Consumer Reporting statutes, NRS Chapter 598C. This is a standalone disclosure document — no extraneous terms are included, in compliance with 9th Circuit requirements.
      </div>
      <div class="legal-box">
        <strong>A3 Smarthome</strong>, operating under license holder <strong>Clifton Wayne Jordan</strong>, may obtain one or more consumer reports and/or investigative consumer reports about you from a consumer reporting agency (CRA) for employment, contracting, or engagement screening purposes.
      </div>
      <div class="field-row cols-2">
        <div class="field-group">
          <label>CRA Name</label>
          <input type="text" id="craName" name="craName" placeholder="Consumer Reporting Agency">
        </div>
        <div class="field-group">
          <label>CRA Phone</label>
          <input type="tel" id="craPhone" name="craPhone" placeholder="(800) 000-0000">
        </div>
      </div>
    </div>

    <!-- ── SECTION 3: SCOPE ───────────────────────────────────────────── -->
    <div class="form-section" data-section="3">
      <div class="section-title">Section 03</div>
      <div class="section-heading">Scope of Investigation</div>
      <p style="font-size:13px;color:var(--gray-600);margin-bottom:14px;">The background investigation may include the following. Review each item carefully.</p>
      <ul class="legal-list">
        <li><strong>Criminal history</strong> — Federal, state, and county. Arrests without conviction limited to 7-year lookback (NRS 598C). Convictions report without time limit (NV SB 409, 2015).</li>
        <li><strong>Sealed records (NRS 179.245)</strong> — Will NOT be requested, reported, or considered. You are not required to disclose sealed records and may lawfully deny their existence per NRS 179.285.</li>
        <li><strong>SSN trace</strong> and identity verification.</li>
        <li><strong>Motor Vehicle Records (MVR)</strong> — Required for field, driving, or site-access roles.</li>
        <li><strong>Credit history</strong> — Only where NRS 613.570 criteria are met. Separate notice will be provided.</li>
        <li><strong>Employment & education verification</strong> — No time limit.</li>
        <li><strong>Trade license & contractor credential verification</strong> (NV State Contractors Board as applicable).</li>
        <li><strong>Reference checks</strong> — Character, professional performance, and conduct.</li>
        <li><strong>Federal sanctions</strong> — OFAC watchlist and GSA debarment screening.</li>
        <li><strong>NOTE:</strong> NV law (NRS 613.570) prohibits use of NV Dept. of Public Safety Sex Offender Registry for employment. Registry data will NOT be used.</li>
      </ul>
      <div class="legal-box important" style="margin-top:16px;">
        Nevada does NOT carry the FCRA $75,000 salary exception. Reporting limits apply regardless of compensation: non-conviction adverse info / liens / civil judgments — 7 years; bankruptcies — 10 years.
      </div>
    </div>

    <!-- ── SECTION 4: YOUR RIGHTS ─────────────────────────────────────── -->
    <div class="form-section" data-section="4">
      <div class="section-title">Section 04</div>
      <div class="section-heading">Your Rights Under FCRA & Nevada Law</div>
      <div class="rights-item"><div class="rights-num">1</div><div class="rights-text">Right to know if a consumer report was used against you in an employment or contracting decision.</div></div>
      <div class="rights-item"><div class="rights-num">2</div><div class="rights-text">Right to a free copy of your consumer report from the CRA within 60 days of any adverse action notice.</div></div>
      <div class="rights-item"><div class="rights-num">3</div><div class="rights-text">Right to dispute inaccurate or incomplete information directly with the CRA.</div></div>
      <div class="rights-item"><div class="rights-num">4</div><div class="rights-text">Right to place a security freeze on your credit report, prohibiting release without your express authorization.</div></div>
      <div class="rights-item"><div class="rights-num">5</div><div class="rights-text">Right to seek actual damages, statutory damages ($100–$1,000/violation), punitive damages, and attorney's fees under FCRA § 1681n/§ 1681o.</div></div>
      <div class="rights-item"><div class="rights-num">6</div><div class="rights-text">Right to file a complaint with the Nevada Labor Commissioner (775-684-1890) for illegal background check or adverse action based on inaccurate information.</div></div>
      <div class="rights-item"><div class="rights-num">7</div><div class="rights-text">Sealed records protection (NRS 179.245) — Not required to disclose; cannot be lawfully reported or used against you.</div></div>
      <div class="legal-box important" style="margin-top:16px;">
        A Summary of Your Rights Under the Fair Credit Reporting Act will be provided separately as required by law.
      </div>
    </div>

    <!-- ── SECTION 5: CREDIT ──────────────────────────────────────────── -->
    <div class="form-section" data-section="5">
      <div class="section-title">Section 05</div>
      <div class="section-heading">Credit Information Notice (NRS 613.570)</div>
      <p style="font-size:13px;color:var(--gray-600);margin-bottom:16px;">Nevada law restricts employer use of credit reports. A credit report will ONLY be obtained if one or more of the following applies. Check all that apply for this position:</p>
      <div class="checkbox-group">
        <label class="checkbox-item">
          <input type="checkbox" name="creditReason" value="legal"> 
          <span class="check-label">Required by state or federal law for this position.</span>
        </label>
        <label class="checkbox-item">
          <input type="checkbox" name="creditReason" value="suspicion">
          <span class="check-label">Reasonable belief the applicant engaged in illegal activity related to financial capacity.</span>
        </label>
        <label class="checkbox-item">
          <input type="checkbox" name="creditReason" value="jobrelated">
          <span class="check-label">Credit information is directly and substantially related to the duties of the position (fiduciary, financial, or asset-control role).</span>
        </label>
        <label class="checkbox-item">
          <input type="checkbox" name="creditReason" value="na" id="creditNA">
          <span class="check-label"><strong>N/A</strong> — Credit report will NOT be obtained for this position.</span>
        </label>
      </div>
    </div>

    <!-- ── SECTION 6: AUTHORIZATION ───────────────────────────────────── -->
    <div class="form-section" data-section="6">
      <div class="section-title">Section 06</div>
      <div class="section-heading">Authorization & Release</div>
      <div class="legal-box">
        I hereby authorize A3 Smarthome, operating under license holder Clifton Wayne Jordan, and its designated agents, representatives, and contracted consumer reporting agencies to conduct a thorough investigation and obtain one or more consumer reports and/or investigative consumer reports on my background, including but not limited to criminal history, driving records, employment history, education, professional licenses, references, financial history (where applicable per NRS 613.570), federal sanctions, and any other legally permissible records.
      </div>
      <div class="legal-box">
        I release from liability all persons, agencies, and organizations that furnish information in response to this authorization. I understand this consent is valid for the initial screening and may be used for re-screening during the period of my engagement, consistent with applicable law.
      </div>
      <p style="font-size:13px;font-weight:600;margin-bottom:10px;">I understand and acknowledge that:</p>
      <ul class="legal-list">
        <li>I may refuse to consent and A3 Smarthome may choose not to hire or engage me as a result.</li>
        <li>Sealed records under NRS 179.245 need not be disclosed and cannot be used against me.</li>
        <li>Inaccurate information in any consumer report may be disputed directly with the CRA.</li>
        <li>If adverse action is taken, I will receive a pre-adverse action notice, a copy of the report, a summary of my FCRA rights, and an opportunity to dispute before a final decision is made.</li>
      </ul>
      <div class="legal-box important" style="margin-top:16px;">
        <strong>I certify that all information I have provided in connection with this background check process is true, complete, and accurate. I understand that misrepresentation or material omission may disqualify me or result in termination of engagement.</strong>
      </div>
    </div>

    <!-- ── SECTION 7: SIGNATURE ───────────────────────────────────────── -->
    <div class="form-section" data-section="7">
      <div class="section-title">Section 07</div>
      <div class="section-heading">Electronic Signature</div>
      <div class="legal-box" style="margin-bottom:20px;">
        By signing below, you acknowledge that you have read, understood, and consent to all terms above. Your electronic signature carries the same legal weight as a handwritten signature under the Electronic Signatures in Global and National Commerce Act (E-SIGN, 15 U.S.C. § 7001) and the Nevada Uniform Electronic Transactions Act (NRS Chapter 719).
      </div>

      <div class="field-row cols-2" style="margin-bottom:20px;">
        <div class="field-group">
          <label>Typed Full Name (to confirm identity) <span class="req">*</span></label>
          <input type="text" id="typedName" name="typedName" placeholder="Type your full legal name" required>
          <div class="field-error" id="typedName-err">Must match full legal name above</div>
        </div>
        <div class="field-group">
          <label>Date <span class="req">*</span></label>
          <input type="date" id="sigDate" name="sigDate" required>
          <div class="field-error" id="sigDate-err">Required</div>
        </div>
      </div>

      <div class="field-group" style="margin-bottom:16px;">
        <label>Draw Your Signature Below <span class="req">*</span></label>
        <div style="height:8px;"></div>
        <div class="sig-wrap" id="sigWrap">
          <canvas id="sigCanvas"></canvas>
          <div class="sig-actions">
            <span class="sig-hint">Draw with mouse, finger, or stylus</span>
            <button type="button" class="btn-clear-sig" onclick="clearSig()">Clear</button>
          </div>
        </div>
        <div class="field-error" id="sig-err" style="margin-top:6px;">Signature is required</div>
      </div>

      <!-- AUDIT TRAIL PANEL -->
      <div class="audit-panel">
        <div class="audit-title">
          <div class="audit-dot"></div>
          Live Audit Trail — Legal Backbone
        </div>
        <div class="audit-row">
          <div class="audit-key">FORM ID</div>
          <div class="audit-val" id="auditFormId">—</div>
        </div>
        <div class="audit-row">
          <div class="audit-key">TIMESTAMP (OPEN)</div>
          <div class="audit-val" id="auditOpen">—</div>
        </div>
        <div class="audit-row">
          <div class="audit-key">TIMESTAMP (SUBMIT)</div>
          <div class="audit-val pending" id="auditSubmit">Pending submission…</div>
        </div>
        <div class="audit-row">
          <div class="audit-key">IP ADDRESS</div>
          <div class="audit-val" id="auditIP">Detecting…</div>
        </div>
        <div class="audit-row">
          <div class="audit-key">GEOLOCATION</div>
          <div class="audit-val pending" id="auditGeo">Requesting…</div>
        </div>
        <div class="audit-row">
          <div class="audit-key">DEVICE / BROWSER</div>
          <div class="audit-val" id="auditUA">—</div>
        </div>
        <div class="audit-row">
          <div class="audit-key">SCREEN RESOLUTION</div>
          <div class="audit-val" id="auditScreen">—</div>
        </div>
        <div class="audit-row">
          <div class="audit-key">TYPED NAME MATCH</div>
          <div class="audit-val pending" id="auditNameMatch">Waiting for input…</div>
        </div>
        <div class="audit-row">
          <div class="audit-key">SIGNATURE CAPTURED</div>
          <div class="audit-val pending" id="auditSigStatus">Not yet signed</div>
        </div>
        <div class="audit-row">
          <div class="audit-key">FORM CHECKSUM</div>
          <div class="audit-val pending" id="auditHash">Pending submission…</div>
        </div>
      </div>

      <div class="submit-wrap">
        <button type="submit" class="btn-submit" id="submitBtn">
          Submit & Sign — Generate Legal Record
        </button>
        <div class="submit-disclaimer">
          Submitting locks this form. A timestamped PDF report will be generated for your records and returned to A3 Smarthome. This action cannot be undone.
        </div>
      </div>
    </div>

  </form>

  <!-- ── SUCCESS SCREEN ─────────────────────────────────────────────── -->
  <div id="successScreen" class="form-section">
    <div class="success-icon">✓</div>
    <div class="success-title">Authorization Submitted</div>
    <div class="success-sub">Your background check consent has been recorded and transmitted to A3 Smarthome.<br>Save your receipt below for your records.</div>
    <div class="receipt-box">
      <div class="receipt-title">Submission Receipt</div>
      <div class="receipt-row"><div class="receipt-key">FORM ID</div><div class="receipt-val" id="rcptFormId">—</div></div>
      <div class="receipt-row"><div class="receipt-key">SUBMITTED BY</div><div class="receipt-val" id="rcptName">—</div></div>
      <div class="receipt-row"><div class="receipt-key">EMAIL</div><div class="receipt-val" id="rcptEmail">—</div></div>
      <div class="receipt-row"><div class="receipt-key">TIMESTAMP</div><div class="receipt-val" id="rcptTime">—</div></div>
      <div class="receipt-row"><div class="receipt-key">IP ADDRESS</div><div class="receipt-val" id="rcptIP">—</div></div>
      <div class="receipt-row"><div class="receipt-key">GEOLOCATION</div><div class="receipt-val" id="rcptGeo">—</div></div>
      <div class="receipt-row"><div class="receipt-key">FORM CHECKSUM</div><div class="receipt-val" id="rcptHash">—</div></div>
    </div>
    <div id="emailStatus" style="font-size:13px;margin-bottom:16px;font-family:var(--mono);min-height:20px;"></div>
    <button class="btn-download-report" onclick="downloadReport()">⬇ Download Audit Report</button>
    <button class="btn-new-form" onclick="resetForm()">New Form</button>

    <div style="margin-top:32px;padding:24px;background:var(--gray-100);border-radius:8px;text-align:left;">
      <div style="font-size:11px;font-weight:700;letter-spacing:1.5px;color:var(--red);font-family:var(--mono);margin-bottom:16px;text-transform:uppercase;">
        ⚙ How to Deploy & Send This Form
      </div>
      <div style="font-size:13px;color:var(--gray-800);line-height:1.9;">
        <strong>Step 1 — Host it free (5 min):</strong><br>
        Go to <a href="https://netlify.com/drop" target="_blank" style="color:var(--red);font-weight:600;">netlify.com/drop</a> → drag the
        <code style="background:#E0E0E0;padding:2px 6px;border-radius:3px;font-size:12px;">A3_BGCheck_ESign_Form.html</code>
        file onto the page → Netlify gives you a live URL instantly
        (e.g. <code style="background:#E0E0E0;padding:2px 6px;border-radius:3px;font-size:12px;">https://radiant-choux-a3bgc.netlify.app</code>).<br><br>

        <strong>Step 2 — Wire up the email (one-time setup):</strong><br>
        1. Go to <a href="https://formspree.io" target="_blank" style="color:var(--red);font-weight:600;">formspree.io</a> → free account → New Form → set destination to
        <code style="background:#E0E0E0;padding:2px 6px;border-radius:3px;font-size:12px;"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="06656a6f60726968286c6974626768466735756b6774726e696b632865696b">[email&#160;protected]</a></code><br>
        2. Copy your Form ID — looks like <code style="background:#E0E0E0;padding:2px 6px;border-radius:3px;font-size:12px;">xpwzgkla</code><br>
        3. Open the HTML file in Notepad or TextEdit, find
        <code style="background:#E0E0E0;padding:2px 6px;border-radius:3px;font-size:12px;">REPLACE_WITH_YOUR_FORMSPREE_ID</code>,
        paste your ID in its place, save<br>
        4. Re-drag the updated file onto Netlify — done. Every signed form now emails you the full audit record automatically.<br><br>

        <strong>Step 3 — Send to reps (pick any method):</strong><br>
        • <strong>Text:</strong> Paste the Netlify URL directly in a text message<br>
        • <strong>Email:</strong> Drop the link in your onboarding email<br>
        • <strong>QR code:</strong> Go to <a href="https://qr.io" target="_blank" style="color:var(--red);">qr.io</a>, paste the URL, download — print it or embed it in your offer letters<br><br>

        <strong>What hits your inbox on every submission:</strong><br>
        Subject line: <code style="background:#E0E0E0;padding:2px 6px;border-radius:3px;font-size:12px;">[A3 BGC] Consent Signed — [Name] — [Form ID]</code><br>
        Body: Full audit report — name, DOB, last 4 SSN, IP address, geolocation, device fingerprint, typed name match, SHA-256 checksum, timestamp, and all consent fields. That is your non-repudiation chain.
      </div>
    </div>
  </div>

</div><!-- /page-wrap -->

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// ─── INIT ────────────────────────────────────────────────────────────────────
let formId, openTimestamp, clientIP = 'Unknown', geoLocation = 'Unknown';
let sigData = null;
let auditRecord = {};

function genFormId() {
  const ts = Date.now().toString(36).toUpperCase();
  const rnd = Math.random().toString(36).substring(2, 6).toUpperCase();
  return `A3-BGC-${ts}-${rnd}`;
}

function fmtDateTime(d) {
  return d.toLocaleString('en-US', {
    year: 'numeric', month: '2-digit', day: '2-digit',
    hour: '2-digit', minute: '2-digit', second: '2-digit',
    timeZoneName: 'short'
  });
}

async function simpleHash(str) {
  const buf = new TextEncoder().encode(str);
  const hash = await crypto.subtle.digest('SHA-256', buf);
  return Array.from(new Uint8Array(hash))
    .map(b => b.toString(16).padStart(2, '0'))
    .join('').substring(0, 32).toUpperCase();
}

function init() {
  formId = genFormId();
  openTimestamp = new Date();

  document.getElementById('formId').textContent = formId;
  document.getElementById('openTime').textContent = fmtDateTime(openTimestamp);
  document.getElementById('uaDisplay').textContent = navigator.userAgent.substring(0, 60) + '…';

  document.getElementById('auditFormId').textContent = formId;
  document.getElementById('auditOpen').textContent = fmtDateTime(openTimestamp);
  document.getElementById('auditUA').textContent = navigator.userAgent.substring(0, 80);
  document.getElementById('auditScreen').textContent = `${screen.width}×${screen.height} (${window.devicePixelRatio}x DPR)`;

  // Set today's date on sig date
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('sigDate').value = today;

  fetchIP();
  fetchGeo();
  initCanvas();
  setupProgress();
  setupNameMatch();
}

async function fetchIP() {
  try {
    const r = await fetch('https://api.ipify.org?format=json');
    const d = await r.json();
    clientIP = d.ip;
    document.getElementById('ipDisplay').textContent = clientIP;
    document.getElementById('auditIP').textContent = clientIP;
    document.getElementById('auditIP').classList.remove('pending');
  } catch(e) {
    clientIP = 'Unavailable';
    document.getElementById('ipDisplay').textContent = 'Unavailable';
    document.getElementById('auditIP').textContent = 'Could not detect';
  }
}

function fetchGeo() {
  if (!navigator.geolocation) {
    geoLocation = 'Not supported';
    setGeo('Not supported');
    return;
  }
  navigator.geolocation.getCurrentPosition(pos => {
    geoLocation = `${pos.coords.latitude.toFixed(5)}, ${pos.coords.longitude.toFixed(5)} (±${Math.round(pos.coords.accuracy)}m)`;
    setGeo(geoLocation);
  }, () => {
    geoLocation = 'Permission denied';
    setGeo('Permission denied');
  });
}

function setGeo(val) {
  document.getElementById('auditGeo').textContent = val;
  document.getElementById('auditGeo').classList.remove('pending');
}

// ─── NAME MATCH ──────────────────────────────────────────────────────────────
function setupNameMatch() {
  document.getElementById('typedName').addEventListener('input', function() {
    const typed = this.value.trim().toLowerCase();
    const full = (document.getElementById('fullName').value || '').trim().toLowerCase();
    const el = document.getElementById('auditNameMatch');
    if (!typed) {
      el.textContent = 'Waiting for input…'; el.className = 'audit-val pending';
    } else if (typed === full && typed.length > 2) {
      el.textContent = '✓ MATCH CONFIRMED'; el.className = 'audit-val'; el.style.color = '#2ECC71';
    } else {
      el.textContent = '✗ Does not match legal name'; el.className = 'audit-val'; el.style.color = '#FF6B6B';
    }
  });
}

// ─── SIGNATURE CANVAS ────────────────────────────────────────────────────────
let canvas, ctx, drawing = false, hasSig = false;

function initCanvas() {
  canvas = document.getElementById('sigCanvas');
  ctx = canvas.getContext('2d');
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  canvas.addEventListener('mousedown', startDraw);
  canvas.addEventListener('mousemove', draw);
  canvas.addEventListener('mouseup', stopDraw);
  canvas.addEventListener('mouseleave', stopDraw);
  canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e.touches[0]); }, { passive: false });
  canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e.touches[0]); }, { passive: false });
  canvas.addEventListener('touchend', stopDraw);
}

function resizeCanvas() {
  const rect = canvas.parentElement.getBoundingClientRect();
  const dpr = window.devicePixelRatio || 1;
  canvas.width = rect.width * dpr;
  canvas.height = 160 * dpr;
  canvas.style.width = rect.width + 'px';
  canvas.style.height = '160px';
  ctx.scale(dpr, dpr);
  ctx.strokeStyle = '#111111';
  ctx.lineWidth = 2.5;
  ctx.lineCap = 'round';
  ctx.lineJoin = 'round';
  if (hasSig && sigData) {
    const img = new Image();
    img.onload = () => ctx.drawImage(img, 0, 0, rect.width, 160);
    img.src = sigData;
  }
}

function getPos(e) {
  const rect = canvas.getBoundingClientRect();
  return { x: e.clientX - rect.left, y: e.clientY - rect.top };
}

function startDraw(e) {
  drawing = true;
  const p = getPos(e);
  ctx.beginPath();
  ctx.moveTo(p.x, p.y);
}

function draw(e) {
  if (!drawing) return;
  const p = getPos(e);
  ctx.lineTo(p.x, p.y);
  ctx.stroke();
  hasSig = true;
  sigData = canvas.toDataURL();
  document.getElementById('sigWrap').classList.add('has-sig');
  document.getElementById('auditSigStatus').textContent = '✓ Signature captured';
  document.getElementById('auditSigStatus').classList.remove('pending');
  document.getElementById('auditSigStatus').style.color = '#2ECC71';
}

function stopDraw() { drawing = false; }

function clearSig() {
  const rect = canvas.getBoundingClientRect();
  ctx.clearRect(0, 0, rect.width, 160);
  hasSig = false; sigData = null;
  document.getElementById('sigWrap').classList.remove('has-sig');
  document.getElementById('auditSigStatus').textContent = 'Not yet signed';
  document.getElementById('auditSigStatus').className = 'audit-val pending';
  document.getElementById('auditSigStatus').style.color = '';
}

// ─── PROGRESS ────────────────────────────────────────────────────────────────
function setupProgress() {
  const sections = document.querySelectorAll('[data-section]');
  const total = sections.length;

  function update() {
    let filled = 0;
    const requiredInputs = document.querySelectorAll('input[required], select[required]');
    let reqFilled = 0;
    requiredInputs.forEach(i => { if (i.value.trim()) reqFilled++; });
    const pct = Math.round((reqFilled / requiredInputs.length) * 100);
    document.getElementById('progressFill').style.width = pct + '%';
    document.getElementById('progressLabel').textContent = pct + '%';
  }

  document.querySelectorAll('input, select, textarea').forEach(el => {
    el.addEventListener('input', update);
    el.addEventListener('change', update);
  });
  update();
}

// ─── VALIDATION ──────────────────────────────────────────────────────────────
function validate() {
  let ok = true;
  const required = [
    { id: 'fullName', msg: 'Full legal name is required' },
    { id: 'dob', msg: 'Date of birth is required' },
    { id: 'ssn4', msg: '4-digit SSN required', pattern: /^\d{4}$/ },
    { id: 'address', msg: 'Address is required' },
    { id: 'city', msg: 'City is required' },
    { id: 'state', msg: 'State is required' },
    { id: 'zip', msg: 'ZIP is required' },
    { id: 'phone', msg: 'Phone number is required' },
    { id: 'email', msg: 'Valid email required', pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/ },
    { id: 'position', msg: 'Position is required' },
    { id: 'sigDate', msg: 'Date is required' },
    { id: 'typedName', msg: 'Typed name is required' },
  ];

  required.forEach(({ id, msg, pattern }) => {
    const el = document.getElementById(id);
    const errEl = document.getElementById(id + '-err');
    const val = el.value.trim();
    let valid = val.length > 0;
    if (valid && pattern) valid = pattern.test(val);
    if (!valid) {
      el.classList.add('error');
      if (errEl) { errEl.textContent = msg; errEl.classList.add('show'); }
      ok = false;
    } else {
      el.classList.remove('error');
      if (errEl) errEl.classList.remove('show');
    }
  });

  // Name match
  const typed = document.getElementById('typedName').value.trim().toLowerCase();
  const full = document.getElementById('fullName').value.trim().toLowerCase();
  if (typed !== full || typed.length < 2) {
    document.getElementById('typedName').classList.add('error');
    document.getElementById('typedName-err').textContent = 'Must match your full legal name exactly';
    document.getElementById('typedName-err').classList.add('show');
    ok = false;
  }

  // Signature
  if (!hasSig) {
    document.getElementById('sig-err').classList.add('show');
    ok = false;
  } else {
    document.getElementById('sig-err').classList.remove('show');
  }

  return ok;
}

// ─── FORM SUBMIT ─────────────────────────────────────────────────────────────
document.getElementById('bgForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  if (!validate()) {
    document.querySelector('.error') && document.querySelector('.error').scrollIntoView({ behavior: 'smooth', block: 'center' });
    return;
  }

  const submitBtn = document.getElementById('submitBtn');
  submitBtn.disabled = true;
  submitBtn.textContent = 'Processing…';

  const submitTime = new Date();

  // Build record
  const rec = {
    formId,
    formVersion: 'A3-BGC-NV-2026-02',
    openTimestamp: fmtDateTime(openTimestamp),
    submitTimestamp: fmtDateTime(submitTime),
    ipAddress: clientIP,
    geolocation: geoLocation,
    userAgent: navigator.userAgent,
    screenResolution: `${screen.width}×${screen.height}`,
    // Applicant fields
    fullName: document.getElementById('fullName').value.trim(),
    dob: document.getElementById('dob').value,
    ssn4: document.getElementById('ssn4').value,
    address: document.getElementById('address').value.trim(),
    city: document.getElementById('city').value.trim(),
    state: document.getElementById('state').value.trim(),
    zip: document.getElementById('zip').value.trim(),
    phone: document.getElementById('phone').value.trim(),
    email: document.getElementById('email').value.trim(),
    dlNum: document.getElementById('dlNum').value.trim(),
    dlState: document.getElementById('dlState').value.trim(),
    position: document.getElementById('position').value.trim(),
    craName: document.getElementById('craName').value.trim(),
    craPhone: document.getElementById('craPhone').value.trim(),
    creditReasons: [...document.querySelectorAll('input[name="creditReason"]:checked')].map(c => c.value).join(', ') || 'None selected',
    typedName: document.getElementById('typedName').value.trim(),
    sigDate: document.getElementById('sigDate').value,
    signatureData: sigData,
    consentGiven: true,
    formJurisdiction: 'State of Nevada',
    governingLaw: 'FCRA 15 U.S.C. § 1681 | NRS Chapter 598C | NRS 613.570 | NRS 179.245 | NRS 179A',
    licenseHolder: 'Clifton Wayne Jordan',
    company: 'A3 Smarthome',
    esignAct: 'E-SIGN 15 U.S.C. § 7001 | NRS Chapter 719',
  };

  // Generate checksum
  const hashInput = `${rec.formId}|${rec.fullName}|${rec.email}|${rec.submitTimestamp}|${rec.ipAddress}`;
  rec.checksum = await simpleHash(hashInput);

  auditRecord = rec;

  // Update audit panel
  document.getElementById('auditSubmit').textContent = rec.submitTimestamp;
  document.getElementById('auditSubmit').classList.remove('pending');
  document.getElementById('auditHash').textContent = rec.checksum;
  document.getElementById('auditHash').classList.remove('pending');

  // Fill success screen
  document.getElementById('rcptFormId').textContent = rec.formId;
  document.getElementById('rcptName').textContent = rec.fullName;
  document.getElementById('rcptEmail').textContent = rec.email;
  document.getElementById('rcptTime').textContent = rec.submitTimestamp;
  document.getElementById('rcptIP').textContent = rec.ipAddress;
  document.getElementById('rcptGeo').textContent = rec.geolocation;
  document.getElementById('rcptHash').textContent = rec.checksum;

  // Store in localStorage for records
  const stored = JSON.parse(localStorage.getItem('a3_bgc_submissions') || '[]');
  const storeRec = { ...rec };
  delete storeRec.signatureData;
  stored.push(storeRec);
  localStorage.setItem('a3_bgc_submissions', JSON.stringify(stored));

  // ── EMAIL VIA FORMSPREE ───────────────────────────────────────────────────
  // Formspree sends to clifton.jordan@a3smarthome.com on every submit.
  // No backend needed — free tier = 50 submissions/month.
  // SETUP: Go to https://formspree.io → New Form → copy your endpoint ID
  //        Replace YOUR_FORMSPREE_ID below with it (e.g. xpwzgkla)
  const FORMSPREE_ID = 'REPLACE_WITH_YOUR_FORMSPREE_ID';

  const emailBody = `
A3 SMARTHOME — BACKGROUND CHECK CONSENT SUBMITTED
══════════════════════════════════════════════════

FORM ID:       ${rec.formId}
SUBMITTED:     ${rec.submitTimestamp}
CHECKSUM:      ${rec.checksum}

── SIGNER ──────────────────────────────────────────
NAME:          ${rec.fullName}
DOB:           ${rec.dob}
SSN LAST 4:    ████ ${rec.ssn4}
EMAIL:         ${rec.email}
PHONE:         ${rec.phone}
POSITION:      ${rec.position}
ADDRESS:       ${rec.address}, ${rec.city}, ${rec.state} ${rec.zip}
DL #:          ${rec.dlNum || 'N/A'} (${rec.dlState || 'N/A'})

── FORENSICS ───────────────────────────────────────
IP ADDRESS:    ${rec.ipAddress}
GEOLOCATION:   ${rec.geolocation}
DEVICE:        ${rec.userAgent}
SCREEN:        ${rec.screenResolution}

── CONSENT ─────────────────────────────────────────
CONSENT GIVEN: YES — SIGNED
SIG DATE:      ${rec.sigDate}
TYPED NAME:    ${rec.typedName}
CREDIT SCOPE:  ${rec.creditReasons}
CRA:           ${rec.craName || 'Not specified'}

── GOVERNING LAW ───────────────────────────────────
FCRA 15 U.S.C. § 1681 | NRS Chapter 598C
NRS 613.570 | NRS 179.245 | E-SIGN 15 U.S.C. § 7001
NRS Chapter 719 (Nevada UETA)

Signed electronically by ${rec.fullName} on ${rec.sigDate}.
This email is the official audit notification for A3 Smarthome.
Retain in applicant file per records retention policy.
  `.trim();

  // Send to Formspree (fires and forgets — doesn't block UI)
  if (FORMSPREE_ID !== 'REPLACE_WITH_YOUR_FORMSPREE_ID') {
    fetch(`https://formspree.io/f/${FORMSPREE_ID}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
      body: JSON.stringify({
        _replyto: rec.email,
        _subject: `[A3 BGC] Consent Signed — ${rec.fullName} — ${rec.formId}`,
        to: 'clifton.jordan@a3smarthome.com',
        message: emailBody,
        // All fields also sent as structured data for Formspree dashboard
        form_id: rec.formId,
        signer_name: rec.fullName,
        signer_email: rec.email,
        signer_phone: rec.phone,
        position: rec.position,
        submitted_at: rec.submitTimestamp,
        ip_address: rec.ipAddress,
        checksum: rec.checksum,
      })
    }).then(r => {
      const emailStatus = document.getElementById('emailStatus');
      if (r.ok) {
        emailStatus.innerHTML = '✓ Notification sent to clifton.jordan@a3smarthome.com';
        emailStatus.style.color = 'var(--success)';
      } else {
        emailStatus.innerHTML = '⚠ Email delivery issue — download report manually below';
        emailStatus.style.color = '#FF6B6B';
      }
    }).catch(() => {
      document.getElementById('emailStatus').innerHTML = '⚠ No internet — download report manually';
      document.getElementById('emailStatus').style.color = '#FF6B6B';
    });
  } else {
    // Formspree not configured — show setup notice
    document.getElementById('emailStatus').innerHTML = '⚠ Email not configured yet — see deployment instructions below';
    document.getElementById('emailStatus').style.color = '#F5A623';
  }

  // Show success
  document.getElementById('bgForm').style.display = 'none';
  const ss = document.getElementById('successScreen');
  ss.style.display = 'block';
  ss.scrollIntoView({ behavior: 'smooth' });
});


</div><!-- /mainApp -->


// ─── LOGIN GATE ──────────────────────────────────────────────────────────────
// Credentials: change these anytime — just update and re-upload to GitHub
const VALID_USERS = {
  'cccrep': 'A3smarthome2026!',
  'admin': 'A3admin2026!',
  'clifton': 'A3admin2026!'
};

function checkLogin() {
  const user = document.getElementById('loginUser').value.trim().toLowerCase();
  const pass = document.getElementById('loginPass').value;
  const err  = document.getElementById('loginErr');
  if (VALID_USERS[user] && VALID_USERS[user] === pass) {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    sessionStorage.setItem('a3_auth', '1');
    init();
  } else {
    err.style.display = 'block';
    document.getElementById('loginPass').value = '';
    document.getElementById('loginPass').focus();
  }
}

document.getElementById('loginForm').addEventListener('submit', function(e) {
  e.preventDefault();
  checkLogin();
});

document.getElementById('loginPass').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') checkLogin();
});

// If already authenticated this session, skip login
if (sessionStorage.getItem('a3_auth') === '1') {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('mainApp').style.display = 'block';
  init();
}


// ─── DOWNLOAD REPORT ─────────────────────────────────────────────────────────
function downloadReport() {
  const r = auditRecord;
  if (!r.formId) return;

  const lines = [
    '═══════════════════════════════════════════════════════════════',
    '  A3 SMARTHOME — BACKGROUND CHECK AUTHORIZATION AUDIT REPORT',
    '═══════════════════════════════════════════════════════════════',
    '',
    '  COMPANY:        A3 Smarthome',
    '  LICENSE HOLDER: Clifton Wayne Jordan',
    '  JURISDICTION:   State of Nevada',
    '  GOVERNING LAW:  FCRA 15 U.S.C. § 1681 | NRS Chapter 598C',
    '                  NRS 613.570 | NRS 179.245 | NRS 179A',
    '  E-SIGN:         15 U.S.C. § 7001 | NRS Chapter 719',
    '',
    '─── AUDIT CHAIN OF CUSTODY ─────────────────────────────────────',
    `  FORM ID:        ${r.formId}`,
    `  FORM VERSION:   ${r.formVersion}`,
    `  OPENED:         ${r.openTimestamp}`,
    `  SUBMITTED:      ${r.submitTimestamp}`,
    `  FORM CHECKSUM:  ${r.checksum}`,
    '',
    '─── SIGNER IDENTITY ─────────────────────────────────────────────',
    `  FULL LEGAL NAME:   ${r.fullName}`,
    `  DATE OF BIRTH:     ${r.dob}`,
    `  LAST 4 SSN:        ████ ████ ████ ${r.ssn4}`,
    `  EMAIL:             ${r.email}`,
    `  PHONE:             ${r.phone}`,
    `  POSITION:          ${r.position}`,
    `  TYPED NAME:        ${r.typedName}`,
    `  SIGNATURE DATE:    ${r.sigDate}`,
    '',
    '─── DEVICE & NETWORK FORENSICS ──────────────────────────────────',
    `  IP ADDRESS:        ${r.ipAddress}`,
    `  GEOLOCATION:       ${r.geolocation}`,
    `  USER AGENT:        ${r.userAgent}`,
    `  SCREEN:            ${r.screenResolution}`,
    '',
    '─── CONSENT SCOPE ───────────────────────────────────────────────',
    `  CONSENT GIVEN:     ${r.consentGiven ? 'YES — SIGNED' : 'NO'}`,
    `  CREDIT REASONS:    ${r.creditReasons}`,
    `  CRA NAME:          ${r.craName || 'Not specified'}`,
    `  CRA PHONE:         ${r.craPhone || 'Not specified'}`,
    '',
    '─── ADDRESS ─────────────────────────────────────────────────────',
    `  ${r.address}`,
    `  ${r.city}, ${r.state} ${r.zip}`,
    '',
    '═══════════════════════════════════════════════════════════════',
    '  LEGAL ATTESTATION',
    '═══════════════════════════════════════════════════════════════',
    '',
    '  This record constitutes a complete and unaltered audit trail',
    '  of the electronic consent and authorization executed by the',
    '  signer identified above.',
    '',
    '  The electronic signature captured in this transaction is',
    '  legally binding under:',
    '    · E-SIGN Act (15 U.S.C. § 7001)',
    '    · Nevada Uniform Electronic Transactions Act (NRS Ch. 719)',
    '',
    '  This document may be used as legal evidence of consent.',
    '  Retain in applicant file per your records retention policy.',
    '',
    `  Generated: ${new Date().toISOString()}`,
    '═══════════════════════════════════════════════════════════════',
  ].join('\n');

  const blob = new Blob([lines], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `A3_BGC_AuditReport_${r.formId}.txt`;
  a.click();
  URL.revokeObjectURL(url);
}

function resetForm() {
  location.reload();
}
</script>
</body>
</html>